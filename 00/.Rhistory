map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list) %.>%
mutate(.,
age = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.numeric(age))
)
demog_data_1900_1979
demog_data_1900_1979 <- (
map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list)
map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list)
map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list) %.>%
mutate(.,
age = case_when(age == "75+" ~ 75,
age == "85+" ~ 85,
TRUE ~ as.numeric(age)
)
map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list) %.>%
mutate(.,
age = case_when(age == "75+" ~ 75,
age == "85+" ~ 85,
TRUE ~ as.numeric(age)
)
)
# combine the results in a combine data file
demog_data_1900_1979 <- (
map_df(1:length(f_v),
.f = make_1demog_data,
fr_ls = file_list) %.>%
mutate(.,
age = case_when(age == "75+" ~ 75,
age == "85+" ~ 85,
TRUE ~ as.numeric(age)
)
)
)
# make nomenclature uniform
demog_data_1900_1979$age <-ifelse(demog_data_1900_1979$age == "75+", 75, demog_data_1900_1979$age)
# combine the results in a combine data file
demog_data_1900_1979 <- map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list)
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.numeric(age)
)
)
# combine the results in a combine data file
demog_data_1900_1979 <- map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list)
# make nomenclature uniform
demog_data_1900_1979$age <-ifelse(demog_data_1900_1979$age == "75+", 75, demog_data_1900_1979$age)
demog_data_1900_1979$age <-ifelse(demog_data_1900_1979$age == "85+", 85, demog_data_1900_1979$age)
# combine the results in a combine data file
demog_data_1900_1979 <- map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list)
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ age
)
)
# combine the results in a combine data file
demog_data_1900_1979 <- map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list)
View(demog_data_1900_1979)
demog_data_1900_1979
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.numeric(age)
)
)
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.character(age)
)
)
# combine the results in a combine data file
demog_data_1900_1979 <- map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list)
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.character(age)
)
)
demog_data_1900_1979 <- demog_data_1900_1979 %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.numeric(age)
)
)
demog_data_1900_1979
demog_data_1900_1979 %.>%
filter_all(any_vars(is.na(.)))
demog_data_1900_1979 %.>%
filter_all(., any_vars(is.na(.)))
demog_data_1900_1979 %.>%
filter_all(., any_vars(is.na(.)))
# combine the results in a combine data file
demog_data_1900_1979 <- (
map_df(1:length(f_v), .f = make_1demog_data, fr_ls = file_list) %.>%
mutate(., age  = case_when(age == "75+"~75,
age == "85+"~85,
TRUE ~ as.numeric(age))
)
)
demog_data_1900_1979
# cast the data into a wide format
demog_data_1900_1979 %.>%
spread(., key = age, value = population)
# cast the data into a wide format
wide_demog_data_1900_1979 <- demog_data_1900_1979 %.>%
spread(., key = age, value = population)
wide_dd_5ac_1900_1979
# making 5 age classes
wide_dd_5ac_1900_1979 <- (
bind_cols(tibble(wide_demog_data_1900_1979[,1]),
tibble(rowSums(wide_demog_data_1900_1979[,2:6])),
tibble(rowSums(wide_demog_data_1900_1979[,7:16])),
tibble(rowSums(wide_demog_data_1900_1979[,14:26])),
tibble(rowSums(wide_demog_data_1900_1979[,27:41])),
tibble(rowSums(
wide_demog_data_1900_1979[,42:ncol(wide_demog_data_1900_1979)]))
)
)
wide_dd_5ac_1900_1979
wide_demog_data_1900_1979[,1])
wide_demog_data_1900_1979[,1]
wide_demog_data_1900_1979[,2:6])
wide_demog_data_1900_1979[,2:6]
wide_demog_data_1900_1979[,7:16]
age_names
wide_demog_data_1900_1979[,14:26]
wide_demog_data_1900_1979[,7:16]
wide_demog_data_1900_1979[,16:26])
wide_demog_data_1900_1979[,16:26]
wide_demog_data_1900_1979[,15:26]
wide_demog_data_1900_1979[,17:26]
wide_demog_data_1900_1979[,27:41]
age_names
wide_demog_data_1900_1979[,42:ncol(wide_demog_data_1900_1979)]
wide_dd_5ac_1900_1979 <- (
bind_cols(tibble(wide_demog_data_1900_1979[,1]),
tibble(rowSums(wide_demog_data_1900_1979[,2:6])),
tibble(rowSums(wide_demog_data_1900_1979[,7:16])),
tibble(rowSums(wide_demog_data_1900_1979[,17:26])),
tibble(rowSums(wide_demog_data_1900_1979[,27:41])),
tibble(rowSums(
wide_demog_data_1900_1979[,42:ncol(wide_demog_data_1900_1979)]))
)
)
wide_dd_5ac_1900_1979
colnames(wide_dd_5ac_1900_1979) <- c("year", age_names)
wide_dd_5ac_1900_1979
# making 5 age classes
wide_dd_5ac_1900_1979 <- (
bind_cols(tibble(wide_demog_data_1900_1979[,1]),
tibble(rowSums(wide_demog_data_1900_1979[,2:6])),
tibble(rowSums(wide_demog_data_1900_1979[,7:16])),
tibble(rowSums(wide_demog_data_1900_1979[,17:26])),
tibble(rowSums(wide_demog_data_1900_1979[,27:41])),
tibble(rowSums(
wide_demog_data_1900_1979[,42:ncol(wide_demog_data_1900_1979)], na.rm = TRUE))
)
)
wide_dd_5ac_1900_1979
colnames(wide_dd_5ac_1900_1979) <- c("year", age_names)
wide_dd_5ac_1900_1979
wide_dd_1980_2017 <- wide_demog_data_1969_2017 %>%
filter(year > 1979)
wide_dd_1900_2017 <- bind_rows(wide_demog_data_1900_1979, wide_dd_1980_2017)
View(wide_dd_1900_2017)
wide_dd_1980_2017 <- wide_demog_data_1969_2017 %.>%
filter(.,
year > 1979)
wide_dd_1900_2017 <- bind_rows(wide_demog_data_1900_1979, wide_dd_1980_2017)
# demography data 1900-2017 (5 age_classes)
wide_dd_5ac_1980_2017  <- wide_dd_5ac_1969_2017 %.>%
filter(.,
year > 1979)
wide_dd_5ac_1980_2017
wide_dd_5ac_1900_2017 <- bind_rows(wide_dd_5ac_1900_1979, wide_dd_5ac_1980_2017)
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017$total <- rowSums(wide_dd_5ac_1900_2017[,-1])
wide_dd_5ac_1900_2017
wide_dd_18ac_1900_2017 %>%
gather(key = "age", value = "population", -year) -> long_dd_18ac_1900_2017
long_dd_18ac_1900_2017$age <- factor(long_dd_18ac_1900_2017$age,
levels = unique(long_dd_18ac_1900_2017$age),
labels = c(age_names, "combined"))
long_dd_18ac_1900_2017 %>%
ggplot(aes(x = year, y = population, group = age)) +
geom_line(aes(colour = age))
# plot the demography
wide_dd_18ac_1900_2017 %>%
gather(key = "age", value = "population", -year) -> long_dd_18ac_1900_2017
# plot the demography
wide_dd_5ac_1900_2017 %>%
gather(key = "age", value = "population", -year) -> long_dd_18ac_1900_2017
long_dd_18ac_1900_2017$age <- factor(long_dd_18ac_1900_2017$age,
levels = unique(long_dd_18ac_1900_2017$age),
labels = c(age_names, "combined"))
long_dd_18ac_1900_2017 %>%
ggplot(aes(x = year, y = population, group = age)) +
geom_line(aes(colour = age))
wide_dd_5ac_1900_2017
rm(long_dd_18ac_1900_2017)
wide_dd_5ac_1900_2017$total
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population) %.>%
mutate(., age_cohort = as.factor(age_cohort))
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(.) +
geom_bar(aes(x = year, y = population, fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(.) +
geom_bar(aes(x = year, fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_hist(aes(fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_histogram(aes(fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
project_theme
# plots related definitions #
project_theme <- (theme_bw(base_size = 13) +
theme(strip.background = element_blank(),
legend.position = "bottom",
legend.background = element_blank(),
legend.key = element_blank()))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as.factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
project_theme
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
project_theme
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_discrete()+
project_theme
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
project_theme
wide_dd_5ac_1900_2017
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_classic2()
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_classic()
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_clean()
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_cleveland()
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_cowplot()
# DELETE when cleaning the codes
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_minimal()
# DELETE when cleaning the codes
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
project_theme
# plots related definitions #
project_theme <- (theme_cowplot(base_size = 13) +
theme(strip.background = element_blank(),
legend.position = "bottom",
legend.background = element_blank(),
legend.key = element_blank()))
# plots related definitions #
project_theme <- (theme_bw(base_size = 13) +
theme(strip.background = element_blank(),
legend.position = "bottom",
legend.background = element_blank(),
legend.key = element_blank()))
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_calc()
?theme_cowplot
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_cowplot(font_size = 13)
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
theme_cowplot(font_size = 13)+
background_grid()
# plots related definitions #
project_theme <- (theme_cowplot(font_size = 13) +
background_grid() +
theme(strip.background = element_blank(),
legend.position = "bottom",
legend.background = element_blank(),
legend.key = element_blank())
)
# DELETE when cleaning the codes
wide_dd_5ac_1900_2017 %.>%
select(., -total) %.>%
gather(., key = age_cohort, value = population, -year) %.>%
mutate(., age_cohort = as_factor(age_cohort)) %.>%
ggplot(., aes(x = year, y = population)) +
geom_area(aes(fill = age_cohort)) +
scale_fill_viridis_d()+
project_theme
birth_data <- read.csv("../raw_data/birth_data.csv")
birth_data <- read.csv("../raw_data/birth_data.csv")
birth_data <- birth_data %>%
arrange(Year) %>%
select(Year, Crude.Birth.Rate) %>%
transmute(year = Year,
per_capita_cbr = Crude.Birth.Rate/1000)
birth_data
birth_data <- birth_data %.>%
arrange(.,
Year) %.>%
select(.,
Year, Crude.Birth.Rate) %.>%
transmute(.,
year = Year,
per_capita_cbr = Crude.Birth.Rate/1000)
birth_data %.>%
arrange(.,
Year)
birth_data <- read.csv("../raw_data/birth_data.csv")
birth_data
birth_data <- birth_data_all %.>%
arrange(.,
Year) %.>%
select(.,
Year, Crude.Birth.Rate) %.>%
transmute(.,
year = Year,
per_capita_cbr = Crude.Birth.Rate/1000)
birth_data_all <- read.csv("../raw_data/birth_data.csv")
birth_data <- birth_data_all %.>%
arrange(.,
Year) %.>%
select(.,
Year, Crude.Birth.Rate) %.>%
transmute(.,
year = Year,
per_capita_cbr = Crude.Birth.Rate/1000)
birth_data
demog_data_1909_2015 <- wide_dd_5ac_1900_2017 %>%
filter(year > 1908 & year < 2016)
demog_data_1909_2015
demog_data_1909_2015 <- left_join(demog_data_1909_2015, birth_data)
demog_data_1909_2015
# combine
demog_data_1909_2015 <- left_join(demog_data_1909_2015, birth_data)
demog_data_1909_2015
# combine
demog_data_1909_2015 <- left_join(demog_data_1909_2015, birth_data)
demog_data_1909_2015
birth_data <- birth_data_all %.>%
arrange(.,
Year) %.>%
select(.,
Year, Crude.Birth.Rate) %.>%
transmute(.,
year = Year,
nu = Crude.Birth.Rate/1000)
# filter relevant demographic data
demog_data_1909_2015 <- wide_dd_5ac_1900_2017 %>%
filter(year > 1908 & year < 2016)
demog_data_1909_2015
# combine with birth-rates
demog_data_1909_2015 <- left_join(demog_data_1909_2015, birth_data)
demog_data_1909_2015
mu_i <- function(data = demog_data_1909_2015,
t = 1910:2015, ac, diff_ac, alpha = 0, ac_1, alpha_1) {
# browser()
nu_splfun <- splinefun(x = data$year,
y = data$nu)
ac_splfun <- splinefun(x = data$year,
y = as.vector(t(data[,ac])))
ac_1_splfun <- splinefun(x = data$year,
y = as.vector(t(data[,ac_1])))
diff_ac_splfun <- splinefun(x = data$year,
y = as.vector(t(data[,diff_ac])))
#browser()
mu_i_t <- (diff_ac_splfun(t) - alpha_1*ac_1_splfun(t-1))/ac_splfun(t) + alpha
#browser()
return(c(NA, mu_i_t))
}
demog_data_1909_2015 %<>%
mutate(mu_1 = (diff_a_1 - nu*total)/a_1 + 1/5,
mu_2 = mu_i(ac = "a_2", ac_1 = "a_1",
diff_ac = "diff_a_2", alpha = 1/10, alpha_1 = 1/5),
mu_3 = mu_i(ac = "a_3", ac_1 = "a_2",
diff_ac = "diff_a_3", alpha = 1/10, alpha_1 = 1/10),
mu_4 = mu_i(ac = "a_4", ac_1 = "a_3",
diff_ac = "diff_a_4", alpha = 1/15, alpha_1 = 1/10),
mu_5 = mu_i(ac = "a_5", ac_1 = "a_4",
diff_ac = "diff_a_5", alpha = 1/40, alpha_1 = 1/15))
demog_data_1909_2015
