age_class = case_when(
age_class == "mu_[0,5)"   ~ "OUT_1",
age_class == "mu_[5,15)"  ~ "OUT_2",
age_class == "mu_[15,25)" ~ "OUT_3",
age_class == "mu_[25,40)" ~ "OUT_4",
age_class == "mu_>40"     ~ "OUT_5")) %.>%
select(., -c(mu, influx)) %.>%
spread(., key = age_class, value = efflux)
cova_efflux <- covar_mu_l %.>%
mutate(.,
age_class = case_when(
age_class == "mu_[0,5)"   ~ "OUT_1",
age_class == "mu_[5,15)"  ~ "OUT_2",
age_class == "mu_[15,25)" ~ "OUT_3",
age_class == "mu_[25,40)" ~ "OUT_4",
age_class == "mu_>40"     ~ "OUT_5")) %.>%
select(., -c(mu, influx)) %.>%
spread(., key = age_class, value = efflux)
rm(cova_efflux)
covar_influx <- covar_mu_l %.>%
mutate(.,
age_class = case_when(
age_class == "mu_[0,5)"   ~ "IN_1",
age_class == "mu_[5,15)"  ~ "IN_2",
age_class == "mu_[15,25)" ~ "IN_3",
age_class == "mu_[25,40)" ~ "IN_4",
age_class == "mu_>40"     ~ "IN_5")
) %.>%
select(.,
-c(mu, efflux)) %.>%
spread(., key = age_class, value = influx)
covar_efflux <- covar_mu_l %.>%
mutate(.,
age_class = case_when(
age_class == "mu_[0,5)"   ~ "OUT_1",
age_class == "mu_[5,15)"  ~ "OUT_2",
age_class == "mu_[15,25)" ~ "OUT_3",
age_class == "mu_[25,40)" ~ "OUT_4",
age_class == "mu_>40"     ~ "OUT_5")) %.>%
select(., -c(mu, influx)) %.>%
spread(., key = age_class, value = efflux)
# collect all the in a single tibble, rename with manageable column names
colnames(demog_data_1910_2015)
demog_data <- demog_data_1910_2015 %>%
select(year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`<40`, combined,
starts_with("mu_")) %>%
transmute(year = year,
N_1 = `[0,5)`, N_2 = `[5,15)`, N_3 = `[15,25)`, N_4 = `[25,40)`, N_5 = `<40`,
MU_1 = `mu_[0,5)`, MU_2 = `mu_[5,15)`, MU_3 = `mu_[15,25)`,
MU_4 = `mu_[25,40)`, MU_5 = `mu_<40`,
Births = combined*nu) %>%
right_join(covar_influx) %>%
right_join(covar_efflux) %>%
dplyr::slice(1:n(), rep(n(), times = 3)) %>%
select(-year) %>%
mutate(Year = seq(1910, 2018),
OUT_1 = -OUT_1, OUT_2 = -OUT_2, OUT_3 = -OUT_3,
OUT_4 = -OUT_4, OUT_5 = -OUT_5)
demog_data_1910_2015
demog_data_1910_2015 %.>%
select(.,
year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`>40`, combined,
starts_with("mu_"))
demog_data_1910_2015 %.>%
select(.,
year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`>40`, combined,
starts_with("mu_")) %.>%
transmute(.,
year = year,
N_1 = `[0,5)`, N_2 = `[5,15)`, N_3 = `[15,25)`, N_4 = `[25,40)`, N_5 = `<40`,
MU_1 = `mu_[0,5)`, MU_2 = `mu_[5,15)`, MU_3 = `mu_[15,25)`,
MU_4 = `mu_[25,40)`, MU_5 = `mu_>40`,
Births = combined*nu)
demog_data_1910_2015 %.>%
select(.,
year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`>40`, combined,
starts_with("mu_")) %.>%
transmute(.,
year = year,
N_1 = `[0,5)`, N_2 = `[5,15)`, N_3 = `[15,25)`, N_4 = `[25,40)`, N_5 = `>40`,
MU_1 = `mu_[0,5)`, MU_2 = `mu_[5,15)`, MU_3 = `mu_[15,25)`,
MU_4 = `mu_[25,40)`, MU_5 = `mu_>40`,
Births = combined*nu)
demog_data <- demog_data_1910_2015 %.>%
select(.,
year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`>40`, combined,
starts_with("mu_")) %.>%
transmute(.,
year = year,
N_1 = `[0,5)`, N_2 = `[5,15)`, N_3 = `[15,25)`, N_4 = `[25,40)`, N_5 = `>40`,
MU_1 = `mu_[0,5)`, MU_2 = `mu_[5,15)`, MU_3 = `mu_[15,25)`,
MU_4 = `mu_[25,40)`, MU_5 = `mu_>40`,
Births = combined*nu) %>%
right_join(covar_influx) %>%
right_join(covar_efflux) %>%
dplyr::slice(1:n(), rep(n(), times = 3)) %>%
select(-year) %>%
mutate(Year = seq(1910, 2018),
OUT_1 = -OUT_1, OUT_2 = -OUT_2, OUT_3 = -OUT_3,
OUT_4 = -OUT_4, OUT_5 = -OUT_5)
demog_data <- demog_data_1910_2015 %.>%
select(.,
year, nu, `[0,5)`,`[5,15)`, `[15,25)`, `[25,40)`,`>40`, combined,
starts_with("mu_")) %.>%
transmute(.,
year = year,
N_1 = `[0,5)`, N_2 = `[5,15)`, N_3 = `[15,25)`, N_4 = `[25,40)`, N_5 = `>40`,
MU_1 = `mu_[0,5)`, MU_2 = `mu_[5,15)`, MU_3 = `mu_[15,25)`,
MU_4 = `mu_[25,40)`, MU_5 = `mu_>40`,
Births = combined*nu) %>%
right_join(covar_influx, by = "year") %>%
right_join(covar_efflux, by = "year") %>%
dplyr::slice(1:n(), rep(n(), times = 3)) %>%
select(-year) %>%
mutate(Year = seq(1910, 2018),
OUT_1 = -OUT_1, OUT_2 = -OUT_2, OUT_3 = -OUT_3,
OUT_4 = -OUT_4, OUT_5 = -OUT_5)
demog_data
vacc_data <- read_csv(file = "../raw_data/nat_vac_cover.csv")
demog_data %>%
right_join(vacc_data) %>%
mutate(year = seq(1910, 2018)) -> demog_vacc_data
load(file = "../raw_data/mumps_cr_ma.Rdata")
load(file = "../processed_data/mumps_case_reports.rds")
mumps_1977_2018_ma
# incidence data #
mumps_inc_data <- mumps_case_reports %>%
mutate(year = Year) %>%
select(-c(Year, total))
mumps_inc_data
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
mutate(., year = Year) %.>%
select(., -c(Year, total))
mumps_inc_data
# this point is to deal with the accumulator variables - t0 will be assigned year 1976
pseudo_NA_point <- tibble(year = 1976,
total = NA, `[0,5)` = NA, `[5,15)` = NA, `[15,25)` = NA,
`[25,40)` = NA, `<40` = NA)
mumps_case_reports
mumps_case_reports
colnames(mumps_case_reports)[1] <- "year"
save(mumps_case_reports, file = "../processed_data/mumps_case_reports.rds")
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
select(., -c(Year, total))
mumps_inc_data
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
select(., -c(Year, total))
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
select(., -c(year, total))
mumps_inc_data
# this point is to deal with the accumulator variables - t0 will be assigned year 1976
pseudo_NA_point <- tibble(year = 1976,
total = NA, `[0,5)` = NA, `[5,15)` = NA, `[15,25)` = NA,
`[25,40)` = NA, `<40` = NA)
pseudo_NA_point
# final incidence data
mumps_inc_data %<>% bind_rows(pseudo_NA_point) %>% select(7, 1:6) %>% arrange(year)
# final incidence data
mumps_inc_data <- mumps_inc_data %.>%
bind_rows(., pseudo_NA_point) %.>%
select(7, 1:6) %.>%
arrange(., year)
# final incidence data
mumps_inc_data <- mumps_inc_data %.>%
bind_rows(., pseudo_NA_point) %.>%
select(., 7, 1:6) %.>%
arrange(., year)
mumps_inc_data
mumps_inc_data
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
select(., -c(year, total))
# this point is to deal with the accumulator variables - t0 will be assigned year 1976
pseudo_NA_point <- tibble(year = 1976,
total = NA, `[0,5)` = NA, `[5,15)` = NA, `[15,25)` = NA,
`[25,40)` = NA, `<40` = NA)
mumps_inc_data
# incidence data #
mumps_inc_data_tmp <- mumps_case_reports %.>%
select(., -c(year, total))
# this point is to deal with the accumulator variables - t0 will be assigned year 1976
pseudo_NA_point <- tibble(year = 1976,
total = NA, `[0,5)` = NA, `[5,15)` = NA, `[15,25)` = NA,
`[25,40)` = NA, `<40` = NA)
# final incidence data
mumps_inc_data <- mumps_inc_data_tmp %.>%
bind_rows(., pseudo_NA_point) %.>%
select(., 7, 1:6) %.>%
arrange(., year)
mumps_inc_data
# incidence data #
mumps_inc_data_tmp <- mumps_case_reports %.>%
select(., -c(year, total))
# this point is to deal with the accumulator variables - t0 will be assigned year 1976
pseudo_NA_point <- tibble(year = 1976,
total = NA, `[0,5)` = NA, `[5,15)` = NA, `[15,25)` = NA,
`[25,40)` = NA, `<40` = NA)
pseudo_NA_point
mumps_inc_data_tmp
mumps_case_reports
mumps_inc_data_tmp
# incidence data #
mumps_inc_data_tmp <- mumps_case_reports %.>%
select(., -c(year, total))
mumps_inc_data_tmp
rm(mumps_inc_data_tmp)
# incidence data #
mumps_inc_data <- mumps_case_reports %.>%
select(., -c(year, total))
mumps_inc_data
# rename the colnames of the inc data for convenience
colnames(mumps_inc_data) <- c("Year", sprintf("D_%d", 1:5), "Du")
mumps_inc_data
mumps_1977_2018_ma
mumps_case_reports %>%
mutate(eta_a = 1-unknown/total) %>%
select(Year, eta_a)
mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total)
mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total) %>%
select(.,
year, eta_a)
# covariate data #
# inferred probabilities of recording an age class (from the data)
eta_a_data <- mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total) %>%
select(.,
year, eta_a)
hacky_eta_a_imputation <- tibble(Year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
eta_a_data %<>%
filter(Year %nin% c(1995, 2015)) %>%
bind_rows(hacky_eta_a_imputation) %>%
arrange(Year) %>%
slice(rep(1, times = 68), 2:n()) %>%
mutate(Year = seq(1910, 2018)) %>%
mutate(eta_a = ifelse(Year < 1977, NA, eta_a))
eta_a_data
hacky_eta_a_imputation <- tibble(Year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
eta_a_data %<>%
filter(Year %nin% c(1995, 2015))
eta_a_data %<>%
filter(year %nin% c(1995, 2015))
hacky_eta_a_imputation <- tibble(Year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
# covariate data #
# inferred probabilities of recording an age class (from the data)
eta_a_data <- mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total) %>%
select(.,
year, eta_a)
hacky_eta_a_imputation <- tibble(Year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(Year < 1977, NA, eta_a))
)
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)
eta_a_data
hacky_eta_a_imputation <- tibble(year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
# covariate data #
# inferred probabilities of recording an age class (from the data)
eta_a_data <- mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total) %>%
select(.,
year, eta_a)
hacky_eta_a_imputation <- tibble(year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015))
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(Year < 1977, NA, eta_a))
)
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year)
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n())
rep(1, times = 68)
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n())
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018))
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015))
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 68), 2:n())
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 69), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(Year < 1977, NA, eta_a))
)
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 67), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(Year < 1977, NA, eta_a))
)
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 67), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(year < 1977, NA, eta_a))
)
eta_a_data
# combine into one covar tibble
mumps_covariates <- demog_vacc_data %>%
select(-year) %>%
full_join(eta_a_data, by = "Year")
# combine into one covar tibble
mumps_covariates <- demog_vacc_data %>%
select(-year) %>%
full_join(eta_a_data, by = "year")
demog_vacc_data
demog_vacc_data
demog_vacc_data <- demog_data %>%
right_join(vacc_data) %>%
mutate(year = seq(1910, 2018))
# covariate data #
# inferred probabilities of recording an age class (from the data)
eta_a_data <- mumps_case_reports %.>%
mutate(.,
eta_a = 1-unknown/total) %>%
select(.,
year, eta_a)
hacky_eta_a_imputation <- tibble(year = c(1995, 2015),
eta_a = c(0.9840213, 0.9991823))
eta_a_data <- (
eta_a_data %.>%
filter(.,
year %nin% c(1995, 2015)) %.>%
bind_rows(.,
hacky_eta_a_imputation)%.>%
arrange(.,
year) %.>%
slice(.,
rep(1, times = 67), 2:n()) %.>%
mutate(.,
year = seq(1910, 2018)) %.>%
mutate(.,
eta_a = ifelse(year < 1977, NA, eta_a))
)
# combine into one covar tibble
mumps_covariates <- demog_vacc_data %>%
#select(-year) %>%
full_join(eta_a_data, by = "year")
mumps_covariates
# combine into one covar tibble
mumps_covariates <- demog_vacc_data %.>%
full_join(.,
eta_a_data, by = "year")
save(mumps_covariates, file = "../processed_data/mumps_covariates.rds")
polymod_UK_5 <- contact_matrix(survey = polymod, countries = "United Kingdom",
age.limits = c(0, 5, 15, 25, 40))
demog_data %>%
filter(Year == 2005) %>%
select(starts_with("N_")) %>%
as.numeric -> US_pop_2005
demog_data
demog_data %.>%
filter(.,
Year == 2005)
US_pop_2005 <- demog_data %.>%
filter(.,
Year == 2005) %.>%
select(.,
starts_with("N_")) %.>%
as.numeric(.)
US_pop_2005
#total number of contacts scaled to the population of the US
E_polymod_US <- matrix(NA, nrow = nrow(polymod_UK_5$matrix), ncol = ncol(polymod_UK_5$matrix))
for(i in 1:nrow(polymod_UK_5$matrix)) {
E_polymod_US[i, ] <- US_pop_2005[i]*polymod_UK_5$matrix[i,]}
dimnames(E_polymod_US) <- list(age_names_5, age_names_5)
dimnames(E_polymod_US) <- list(age_names, age_names)
#making the matrix symmtric:
Es_polymod_US <- 0.5*(E_polymod_US + t(E_polymod_US))
#Average daily contacts for US:
Cs_polymod_US_5 <- matrix(NA, nrow = nrow(polymod_UK_5$matrix), ncol = ncol(polymod_UK_5$matrix))
for(i in 1:nrow(polymod_UK_5$matrix)) {
Cs_polymod_US_5[i, ] <- 1/US_pop_2005[i]* Es_polymod_US[i,]}
dimnames(Cs_polymod_US_5) <- list(age_names_5, age_names_5)
contact_matrix <- Cs_polymod_US_5
save(contact_matrix, file = "../processed_data/contact_matrix.rds")
contact_matrix
rm(list = ls())
source('~/Documents/GitHub/mumps2021/process_raw_data/src_process_data.R', echo=TRUE)
source('~/Documents/GitHub/mumps2021/process_raw_data/src_process_data.R', echo=TRUE)
source('~/Documents/GitHub/mumps2021/process_raw_data/src_process_data.R', echo=TRUE)
source('~/Documents/GitHub/mumps2021/process_raw_data/case_report_data.R', echo=TRUE)
load(file = "../processed_data/mumps_case_reports.rds")
source("../00/src.R", chdir = TRUE)
source("./case_report_data.R")
dev.off()
rm(list = ls())
source("../00/src.R", chdir = TRUE)
source("./case_report_data.R")
source("./demog_data_5ac.R")
source('~/Documents/GitHub/mumps2021/process_raw_data/src_process_data.R', echo=TRUE)
